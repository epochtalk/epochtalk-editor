<html>
<head>
  <title>EpochTalk Editor</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/medium-editor.css"> <!-- Core -->
  <link rel="stylesheet" href="css/themes/mani.css" id="medium-editor-theme">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
</head>
<body>
  <!-- Navigation -->
  <div class="nav-container clearfix">
    <div class="pull-right">
      <select name="editor-select" id="editor-select">
        <option value="medium">Medium</option>
        <option value="bbcode">BBCode</option>
      </select>
    </div>
  </div>

  <div class="main-container">
    <!-- Medium Editor -->
    <div id="medium-editor-container" class="editor-container">
      <div class="editor-header-container">
        <span class="editor-header">Medium</span>
      </div>
      <div class="medium-buttons">
        <button onclick="editableCommand('bold');">
          <i class="fa fa-bold"></i>
        </button>
         <button onclick="editableCommand('italic');">
          <i class="fa fa-italic"></i>
        </button>
        <button onclick="editableCommand('underline');">
          <i class="fa fa-underline"></i>
        </button>
        <button onclick="editableCommand('anchor');">
          <i class="fa fa-link"></i>
        </button>
        <button onclick="editableCommand('append-h3');">
          <b>H1</b>
        </button>
        <button onclick="editableCommand('append-h4');">
          <b>H2</b>
        </button>
        <button onclick="editableCommand('append-blockquote');">
          <i class="fa fa-quote-right"></i>
        </button>
        <button onclick="editableCommand('subscript');">
          <i class="fa fa-subscript"></i>
        </button>
        <button onclick="editableCommand('superscript');">
          <i class="fa fa-superscript"></i>
        </button>
        <button onclick="editableCommand('strikethrough');">
          <strike>A</strike>
        </button>
        <button onclick="editableCommand('insertunorderedlist');">
          <i class="fa fa-list-ul"></i>
        </button>
        <button onclick="editableCommand('insertorderedlist');">
          <i class="fa fa-list-ol"></i>
        </button>
      </div>
      <div id="medium-editor" class="editable medium-editor" contenteditable="true" data-placeholder="Type your text" data-medium-element="true">
        Slow-carb lomo next level, Thundercats banjo High Life Echo Park roof party Intelligentsia gluten-free locavore Shoreditch Portland master cleanse skateboard. Leggings Shoreditch vinyl chambray tote bag, kitsch meggings fixie. Mumblecore deep v Truffaut pour-over Helvetica. Fixie artisan XOXO Pinterest narwhal High Life, single-origin coffee Etsy sartorial distillery bespoke butcher trust fund Pitchfork. Raw denim quinoa pickled, cardigan PBR cred butcher McSweeney's vegan salvia chillwave Helvetica. Schlitz small batch Truffaut you probably haven't heard of them, kogi street art stumptown lomo selvage jean shorts wolf post-ironic. Bushwick messenger bag yr Marfa chia.
      </div>
    </div>

    <!-- BBCode Editor -->
    <div id="bbcode-editor-container" class="editor-container hide-editor">
      <div class="editor-header-container">
        <span class="editor-header">BBCode</span>
      </div>
      <div class="medium-buttons">
        <button onmousedown="bbcodeCommand('[b]', '[/b]');">
          <i class="fa fa-bold"></i>
        </button>
         <button onmousedown="bbcodeCommand('[i]', '[/i]');">
          <i class="fa fa-italic"></i>
        </button>
        <button onmousedown="bbcodeCommand('[u]', '[/u]');">
          <i class="fa fa-underline"></i>
        </button>
        <button onmousedown="bbcodeCommand('[url]', '[/url]');">
          <i class="fa fa-link"></i>
        </button>
        <button onmousedown="bbcodeCommand('[size=20pt]', '[/size]');">
          <b>H1</b>
        </button>
        <button onmousedown="bbcodeCommand('[size=15pt]', '[/size]');">
          <b>H2</b>
        </button>
        <button onmousedown="bbcodeCommand('[quote]', '[/quote]');">
          <i class="fa fa-quote-right"></i>
        </button>
        <button onmousedown="bbcodeCommand('[sub]', '[/sub]');">
          <i class="fa fa-subscript"></i>
        </button>
        <button onmousedown="bbcodeCommand('[sup]', '[/sup]');">
          <i class="fa fa-superscript"></i>
        </button>
        <button onmousedown="bbcodeCommand('[s]', '[/s]');">
          <strike>A</strike>
        </button>
        <button onmousedown="bbcodeCommand('[ul]', '[/ul]');">
          <i class="fa fa-list-ul"></i>
        </button>
        <button onmousedown="bbcodeCommand('[ol]', '[/ol]');">
          <i class="fa fa-list-ol"></i>
        </button>
      </div>
      <div class="split-container">
        <div class="half-column">
          <div id="bbcode-editor" class="bbcode-editor" contenteditable="true" onkeyup="processBBCode();"></div>
        </div>
        <div class="half-column">
          <div id="bbcode-preview" class="bbcode-preview"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPTS!!! -->
  <script src="js/medium-editor.js"></script>
  <script src="js/xbbcode.js"></script>
  <script>
    // editor switcher
    var editorSelect = document.getElementById('editor-select');
    editorSelect.addEventListener("change", function() {
      // get selected option
      var selectedIndex = editorSelect.options.selectedIndex;
      var selectedOption = editorSelect.options[selectedIndex];
      var editorValue = selectedOption.value;

      // switch editor based on value
      if (editorValue === 'bbcode') {
        var bbcodeContainer = document.getElementById('bbcode-editor-container');
        bbcodeContainer.className += ' show-editor';
        bbcodeContainer.className = 
          bbcodeContainer.className.replace( /(?:^|\s)hide-editor(?!\S)/g , '' );

        var bbcodeContainer = document.getElementById('medium-editor-container');
        bbcodeContainer.className += ' hide-editor';
        bbcodeContainer.className = 
          bbcodeContainer.className.replace( /(?:^|\s)show-editor(?!\S)/g , '' );
      }
      else {
        var bbcodeContainer = document.getElementById('medium-editor-container');
        bbcodeContainer.className += ' show-editor';
        bbcodeContainer.className = 
          bbcodeContainer.className.replace( /(?:^|\s)hide-editor(?!\S)/g , '' );

        var bbcodeContainer = document.getElementById('bbcode-editor-container');
        bbcodeContainer.className += ' hide-editor';
        bbcodeContainer.className = 
          bbcodeContainer.className.replace( /(?:^|\s)show-editor(?!\S)/g , '' );
      }
    });

    // Medium Editor
    var editor = new MediumEditor('.editable', {
        buttonLabels: 'fontawesome',
        buttons: ['bold', 'italic', 'underline', 'anchor', 'header1', 'header2', 'quote', 'superscript', 'subscript', 'strikethrough', 'unorderedlist', 'orderedlist'],
        targetBlank: true
    });

    // bind to Medium Editor's input event
    window.addEventListener('load', function() {
      document.getElementById('medium-editor').addEventListener('input', function() {
        var text = document.getElementById('medium-editor').innerHTML;
        document.getElementById('bbcode-preview').innerHTML = text;
        document.getElementById('bbcode-editor').innerHTML = text;
      });
    });

    // BBCode Editor
    function processBBCode() {
      var code = document.getElementById("bbcode-editor").innerHTML;
      var result = XBBCODE.process({text: code});
      document.getElementById('bbcode-preview').innerHTML = result.html;
      document.getElementById('medium-editor').innerHTML = result.html;
    }

    // static editor buttons commands
    function editableCommand(command, parameter) { 
      editor.execAction(command, parameter);
    }

    function bbcodeCommand(open, close) {
      // get selection
      var text, selection;
      if (document.selection) { selection = document.selection.createRange().text; }
      else { selection = window.getSelection(); }

      // prepend
      text = selection.toString();
      text = open + text + close;

      // append text
      if (selection.rangeCount) {
        range = selection.getRangeAt(0);
        range.deleteContents();
        var textNode = document.createTextNode(text);
        range.insertNode(textNode);
        processBBCode();
      }
    }
  </script>
</body>
</html>