<html>
<head>
  <title>EpochTalk Editor Example</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/medium-editor.css"> <!-- Core -->
  <link rel="stylesheet" href="css/themes/mani.css" id="medium-editor-theme">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
</head>

<body>
  <!-- Navigation -->
  <div class="ee-nav-container clearfix">
    <div class="pull-left">
      <div class="ee-buttons ee-medium-buttons">
        <button onclick="editableCommand('bold');">
          <i class="fa fa-bold"></i>
        </button>
         <button onclick="editableCommand('italic');">
          <i class="fa fa-italic"></i>
        </button>
        <button onclick="editableCommand('underline');">
          <i class="fa fa-underline"></i>
        </button>
        <button onclick="editableCommand('anchor');">
          <i class="fa fa-link"></i>
        </button>
        <button onclick="editableCommand('append-h3');">
          <b>H1</b>
        </button>
        <button onclick="editableCommand('append-h4');">
          <b>H2</b>
        </button>
        <button onclick="editableCommand('append-blockquote');">
          <i class="fa fa-quote-right"></i>
        </button>
        <button onclick="editableCommand('subscript');">
          <i class="fa fa-subscript"></i>
        </button>
        <button onclick="editableCommand('superscript');">
          <i class="fa fa-superscript"></i>
        </button>
        <button onclick="editableCommand('strikethrough');">
          <strike>A</strike>
        </button>
        <button onclick="editableCommand('insertunorderedlist');">
          <i class="fa fa-list-ul"></i>
        </button>
        <button onclick="editableCommand('insertorderedlist');">
          <i class="fa fa-list-ol"></i>
        </button>
      </div>
      <div class="ee-buttons ee-bbcode-buttons ee-hide">
        <button onmousedown="bbcodeCommand('[b]', '[/b]');">
          <i class="fa fa-bold"></i>
        </button>
         <button onmousedown="bbcodeCommand('[i]', '[/i]');">
          <i class="fa fa-italic"></i>
        </button>
        <button onmousedown="bbcodeCommand('[u]', '[/u]');">
          <i class="fa fa-underline"></i>
        </button>
        <button onmousedown="bbcodeCommand('[url]', '[/url]');">
          <i class="fa fa-link"></i>
        </button>
        <button onmousedown="bbcodeCommand('[size=20pt]', '[/size]');">
          <b>H1</b>
        </button>
        <button onmousedown="bbcodeCommand('[size=15pt]', '[/size]');">
          <b>H2</b>
        </button>
        <button onmousedown="bbcodeCommand('[quote]', '[/quote]');">
          <i class="fa fa-quote-right"></i>
        </button>
        <button onmousedown="bbcodeCommand('[sub]', '[/sub]');">
          <i class="fa fa-subscript"></i>
        </button>
        <button onmousedown="bbcodeCommand('[sup]', '[/sup]');">
          <i class="fa fa-superscript"></i>
        </button>
        <button onmousedown="bbcodeCommand('[s]', '[/s]');">
          <strike>A</strike>
        </button>
        <button onmousedown="bbcodeCommand('[ul]', '[/ul]');">
          <i class="fa fa-list-ul"></i>
        </button>
        <button onmousedown="bbcodeCommand('[ol]', '[/ol]');">
          <i class="fa fa-list-ol"></i>
        </button>
      </div>
    </div>
    <div class="pull-right">
      <select name="editor-select" class="ee-editor-select">
        <option value="medium">Medium</option>
        <option value="bbcode">BBCode</option>
      </select>
    </div>
  </div>

  <div class="ee-main-container">
    <!-- Medium Editor -->
    <div class="ee-editor-container ee-medium-container">
      <div class="editable ee-medium-editor" contenteditable="true" data-medium-element="true">
        Slow-carb lomo next level, Thundercats banjo High Life Echo Park roof party Intelligentsia gluten-free locavore Shoreditch Portland master cleanse skateboard. Leggings Shoreditch vinyl chambray tote bag, kitsch meggings fixie. Mumblecore deep v Truffaut pour-over Helvetica. Fixie artisan XOXO Pinterest narwhal High Life, single-origin coffee Etsy sartorial distillery bespoke butcher trust fund Pitchfork. Raw denim quinoa pickled, cardigan PBR cred butcher McSweeney's vegan salvia chillwave Helvetica. Schlitz small batch Truffaut you probably haven't heard of them, kogi street art stumptown lomo selvage jean shorts wolf post-ironic. Bushwick messenger bag yr Marfa chia.
      </div>
    </div>

    <!-- BBCode Editor -->
    <div class="ee-editor-container ee-bbcode-container ee-hide-editor">
      <div class="ee-split-container">
        <div class="ee-half-column">
          <div class="ee-bbcode-editor" contenteditable="true" onkeyup="processBBCode(this);"></div>
        </div>
        <div class="ee-half-column">
          <div class="ee-bbcode-preview"></div>
        </div>
      </div>
    </div>
  </div>


  <!-- SCRIPTS!!! -->
  <script src="js/medium-editor.js"></script>
  <script src="js/xbbcode.js"></script>
  <script>
    // editor switcher
    var selectArray = document.getElementsByClassName('ee-editor-select');
    editorSelectArray = [].slice.call(selectArray);
    editorSelectArray.forEach(function(editorSelect) {
      editorSelect.addEventListener("change", function() {
        // get selected option
        var selectedIndex = editorSelect.options.selectedIndex;
        var selectedOption = editorSelect.options[selectedIndex];
        var editorValue = selectedOption.value;

        // Gets significant elements within the dom
        var navParent = editorSelect.parentNode.parentNode;
        var topContainer = navParent.parentNode;
        var bbcodeBtnList = navParent.getElementsByClassName('ee-bbcode-buttons')[0];
        var mediumBtnList = navParent.getElementsByClassName('ee-medium-buttons')[0];

        // switch editor based on value
        if (editorValue === 'bbcode') {
          mediumBtnList.className = 'ee-buttons ee-medium-buttons ee-hide';
          bbcodeBtnList.className = 'ee-buttons ee-bbcode-buttons ee-show';
          editor.hideToolbarActions();

          var bbcodeContainer = topContainer.getElementsByClassName('ee-bbcode-container')[0];
          bbcodeContainer.className = 'ee-editor-container ee-bbcode-container ee-show-editor';

          var mediumContainer = topContainer.getElementsByClassName('ee-medium-container')[0];
          mediumContainer.className = 'ee-editor-container ee-medium-container ee-hide-editor';
        }
        else {
          mediumBtnList.className = 'ee-buttons ee-medium-buttons ee-show';
          bbcodeBtnList.className = 'ee-buttons ee-bbcode-buttons ee-hide';

          var mediumContainer = topContainer.getElementsByClassName('ee-medium-container')[0];
          mediumContainer.className = 'ee-editor-container ee-medium-container ee-show-editor';

          var bbcodeContainer = topContainer.getElementsByClassName('ee-bbcode-container')[0];
          bbcodeContainer.className = 'ee-editor-container ee-bbcode-container ee-hide-editor';
        }
      });
    });

    // Medium Editor
    var editor = new MediumEditor('.editable', {
        buttonLabels: 'fontawesome',
        buttons: ['bold', 'italic', 'underline', 'anchor', 'header1', 'header2', 'quote', 'superscript', 'subscript', 'strikethrough', 'unorderedlist', 'orderedlist'],
        targetBlank: true
    });

    // bind to Medium Editor's input event
    window.addEventListener('load', function() {
      var mediumEditors = document.getElementsByClassName('ee-medium-editor');
      mediumEditors = [].slice.call(mediumEditors);
      mediumEditors.forEach(function(mediumEditor) {
        mediumEditor.addEventListener('input', function() {
          var text = mediumEditor.innerHTML;
          var mainContainer = mediumEditor.parentNode.parentNode;
          var bbcodePreview = mainContainer.getElementsByClassName('ee-bbcode-preview')[0];
          bbcodePreview.innerHTML = text;
          var bbcodeEditor = mainContainer.getElementsByClassName('ee-bbcode-editor')[0];
          bbcodeEditor.innerHTML = text;
        });
      });
    });

    // BBCode Editor
    function processBBCode(element) {
      var code = element.innerHTML;
      var result = XBBCODE.process({text: code});

      // replace text in ee-bbcode-preview
      var splitContainer = element.parentNode.parentNode; // ee-half-column > ee-split-container
      var bbcodePreview = splitContainer.getElementsByClassName('ee-bbcode-preview');
      bbcodePreview[0].innerHTML = result.html;

      // replace text in medium editor
      // bbcode-editor-container > main-container
      var mainContainer = splitContainer.parentNode.parentNode; 
      var mediumEditor = mainContainer.getElementsByClassName('ee-medium-editor');
      mediumEditor[0].innerHTML = result.html;
    }

    // static editor buttons commands
    function editableCommand(command, parameter) { 
      editor.execAction(command, parameter); 
    }

    function bbcodeCommand(open, close) {
     if (document.activeElement.className !== 'ee-bbcode-editor') { return; }

      // get selection
      var text, selection;
      if (document.selection) { selection = document.selection.createRange().text; }
      else { selection = window.getSelection(); }

      // prepend and append tags
      text = selection.toString();
      var taggedText = open + text + close;

      // append text
      if (selection.rangeCount) {
        range = selection.getRangeAt(0);
        range.deleteContents();
        var textNode = document.createTextNode(taggedText);
        range.insertNode(textNode);

        // set cursor
        var selRange = document.createRange();
        selRange.setStart(textNode, open.length + text.length);
        selRange.setEnd(textNode, open.length + text.length);
        selection.removeAllRanges();
        // hack to get the cursor to show up in chrome
        setTimeout(function() {
          selection.addRange(selRange);
        }, 1);
      }
    }
  </script>
</body>
</html>